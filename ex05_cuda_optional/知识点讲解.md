# ex05 知识点讲解：CUDA 场景下的 Makefile（可选）

本关目标：看懂最小 CUDA 项目在 Makefile 里如何管理架构和编译参数。

---

## 1) `NVCC` 和 `CUDA_ARCH`

- `NVCC`：CUDA 编译器
- `CUDA_ARCH`：目标 GPU 架构号（例如 89）

命令行可覆盖：

```bash
make CUDA_ARCH=89
```

---

## 2) `-gencode` 的基本含义

```make
-gencode arch=compute_$(CUDA_ARCH),code=sm_$(CUDA_ARCH)
-gencode arch=compute_$(CUDA_ARCH),code=compute_$(CUDA_ARCH)
```

- `sm_xx`：针对该架构的机器码
- `compute_xx`：保留 PTX，提升前向兼容性

---

## 3) 为什么这关放“可选”

因为你当前主目标是先把 Makefile 基础打牢，再进 CUDA 项目。  
这关是把前四关知识迁移到 CUDA 场景，不是先修课。

---

## 4) TASK 推荐顺序

1. 默认编译运行一次
2. 改 `CUDA_ARCH` 再编译一次
3. 把 `n` 做成命令行参数
4. 给 Makefile 增加 `profile` 目标（调用 `ncu`）

---

## 5) 你后续两个项目怎么复用这关

- `final_project`：复用 `CUDA_ARCH` 参数覆盖
- `cuda_cpp_interview_lab`：复用 `profile` 目标组织方式

---

## 6) 常见错误

- 本机 `nvcc` 不支持你设的架构号
- 只生 `sm_xx` 不带 `compute_xx`，后续兼容差
- profile 命令写在 shell 历史里，没固化成 `make profile`
