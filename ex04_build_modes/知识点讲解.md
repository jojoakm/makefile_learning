# ex04 知识点讲解：Debug/Release 构建模式

本关目标：掌握一个工程里最常见的“同一套代码，多种构建参数”。

---

## 1) `BUILD` 变量控制构建分支

Makefile 里通过 `ifeq` 判断：

- `BUILD=debug`：`-O0 -g -DDEBUG`
- `BUILD=release`：`-O3 -DNDEBUG`

这样你不用改文件，只改命令行参数。

---

## 2) 为什么区分两种模式

- Debug：便于调试、看变量、追 bug
- Release：便于性能测试和交付

你做性能数据时应该优先 `release`。

---

## 3) 分目录构建的意义

`BUILD_DIR := build/$(BUILD)` 可以让 debug/release 产物互不污染。  
不用每次切模式都强制 `clean`。

---

## 4) `debug/release` 目标本质

```make
debug:
	$(MAKE) BUILD=debug
```

它是“递归调用 make 并传参”的快捷入口，方便团队统一操作习惯。

---

## 5) `test` 目标是最低自动化测试

本关 `test` 会执行程序并比对输出。  
你后续项目里也应保持这个习惯：每次改完至少跑一个自动检查目标。

---

## 6) TASK 推荐顺序

1. `make BUILD=debug`
2. `make test`
3. `make BUILD=release`
4. 新增 `sanitize` 构建模式（如 `-fsanitize=address`）
5. 更新 `help`

---

## 7) 常见错误

- `BUILD` 传了非法值，触发 `$(error ...)`
- debug/release 共用同一 `build` 目录导致混淆
- 只跑 build 不跑 test，问题延迟暴露
