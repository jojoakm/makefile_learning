# ex03 知识点讲解：模式规则 + 自动依赖

本关目标：减少重复规则，让工程可扩展且头文件改动可自动触发重编。

---

## 1) 三个关键变量

- `SRCS`：源码列表（`wildcard` 自动收集）
- `OBJS`：目标文件列表（`patsubst` 从 `SRCS` 推导）
- `DEPS`：依赖文件列表（由 `.o` 映射为 `.d`）

这三者是自动化的核心。

---

## 2) 模式规则为什么强

```make
$(BUILD_DIR)/%.o: $(SRC_DIR)/%.cpp
```

意思是：任意 `src/xxx.cpp` 都按同一规则编译成 `build/xxx.o`。  
新增 `.cpp` 文件时，通常不用再手写新规则。

---

## 3) `-MMD -MP` 干了什么

编译时自动生成 `.d` 依赖文件，记录“这个 `.o` 依赖哪些头文件”。

- `-MMD`：生成用户头文件依赖
- `-MP`：给依赖目标补空规则，避免删除头文件后 make 报错

配合：

```make
-include $(DEPS)
```

就实现了“改 `.h` 自动触发正确的增量编译”。

---

## 4) 你该怎么验证它真的生效

1. `make`
2. 修改 `include/stats.h`
3. 再 `make`
4. 观察只重编受影响文件，而不是全量重编

---

## 5) TASK 推荐顺序

1. 看懂 `SRCS/OBJS/DEPS`
2. 跑一遍头文件改动验证
3. 新增一个 `min_value` 模块（`.h + .cpp`），尽量不改 Makefile

---

## 6) 常见错误

- `.d` 没被 include：头文件改动不触发重编
- 模式规则路径写错：找不到源文件
- `build` 目录未创建：编译输出失败
